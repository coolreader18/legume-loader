(function(e,t){function r(e,t){try{e=new URL(e)}catch(r){if(r.message=="Failed to construct 'URL': Invalid URL"){e=new URL(e,t||location)}else throw r}var r={url:e,originalUrl:e};var n=e.pathname.split("/");var i=n[0].split("@");var s={github:function(){var t=n[1].split("@");return{url:new URL("https://cdn.jsdelivr.net/gh/"+e.pathname),name:t[0],version:t[1]||"latest"}},npm:function(){return{url:new URL("https://cdn.jsdelivr.net/npm/"+e.pathname),name:i[0],version:i[1]||"latest",legumescript:true}},gist:function(){return{name:n[1].split(".")[0],gist:{id:i[0],file:n[1],hash:i[1]}}}};var a=e.protocol.split(":")[0];r.method=a;if(a in s){Object.assign(r,s[a]())}else{Object.assign(r,{name:e.pathname.split("/").slice(-1)[0].split(".")[0]})}return r}t.Legume=Object.assign(function e(t,i){var i=i||{};var s={};Object.assign(s,r(t,i.urlref));var a=Object.values(e.scripts).find(function(e){return e.url&&(e.url.href==s.url.href||e.originalUrl.href==s.originalUrl.href)});if(a){return Promise.resolve(n(a.name))}var u=s.gist;var l=Promise.resolve(s.method=="gist"&&fetch("https://api.github.com/gists/"+u.id+(u.hash?"/"+u.hash:"")).then(function(e){return e.json()}).then(function(e){var t=e.files[u.file];if(!t)throw new Error("File not in gist");s.url=new URL(t.raw_url);if(t.truncated)return fetch(s.url).then(function(e){return e.text()}).then(function(e){s.code=e});s.code=t.content}));return l.then(function(){return e.scripts[s.name]?n(s.name):"code"in s?e.process(s,i.dontload):fetch(s.url).then(function(e){return e.text()}).then(function(t){s.code=t;return e.process(s,i.dontload)})})},{version:"dev",scripts:{},cache:{},require:n,global:{require:n},style:function e(t,n){t=r(t,n).url;document.head.appendChild(Object.assign(document.createElement("link"),{rel:"stylesheet",href:t}))},process:function(e,t){if(typeof e=="string")e={code:e};e=i(e);e.name=e.name||e.metadata.name;e.loads=0;if(Legume.scripts[e.name])if(!t){return n(e.name)}else return;Legume.scripts[e.name]=e;var r=Promise.resolve(),s=e.requires;if(s.styles)s.styles.forEach(function(e){Legume.style(e)});if(s.scripts)r=r.then(function(){return Promise.all(s.scripts.reduce(function(t,r){t.push(Legume(r.script,{dontload:true,urlref:e.url}));return t},[]))});return r.then(function(){if(!t)n(e.name)})}});Legume.global.global=Legume.global;function n(e){e=Legume.scripts[e]||Object.values(Legume.scripts).find(function(t){return t.metadata&&t.metadata.name==e});if(!e){throw new Error("Module not loaded")}if(Legume.cache[e.name]&&!e.bookmarklet)return Legume.cache[e.name];e.loads++;var t={exports:{},children:e.children,legumeInfo:{loads:e.loads}};t.require=function e(t){this.children[t]=Legume.scripts[t];return e(t)}.bind(t);var i={module:t,require:t.require,exports:t.exports};var s=["module","exports"];var a=e.requires;if(a.scripts){a.scripts.forEach(function(t){if(t.as&&!Object.keys(i).includes(t.as)){i[t.as]=n(r(t.script,e.url).name);s.push(t.as)}})}var u=e.code+(e.url||e.name?"\n//# sourceURL="+(e.url||"inline-legume:"+e.name):"");if(e.legumescript){eval.call(window,"with(Legume.global)("+Function.apply(null,s.concat([u])).toString()+")").apply(Legume.global,s.reduce(function(e,t){e.push(i[t]);return e},[]));Legume.cache[e.name]=t.exports;return i.module.exports}else{return eval.call(window,u)}}function i(e){var t=false,r={start:/^(\s*\/\*\s*@legume\s*)/i,end:/^\s*\*\//},n={name:"",version:"",description:"",repository:"",author:[],email:"",url:"",license:"",bookmarklet:false,require:[],style:[]},i={},s=[],a=[],u=function(e){var t=e.trim().match(/@([^\s]+)(?:\s+(.*))?$/);if(t){var r=t[1],s=t[2];if(r!==undefined){if(Array.isArray(n[r])){i[r]=i[r]||[];i[r].push(s)}else if(typeof n[r]=="boolean"){try{i[r]=JSON.parse(s)}catch(e){i[r]=true}}else{i[r]=s}}else{console.warn("ignoring invalid metadata option: `"+r+"}`")}}};e.code.match(/[^\r\n]+/g).forEach(function(n,i,l){if(r.end.test(n)&&t){t=false}else if(t){u(n)}else if(r.start.test(n)){t=true;e.legumescript=true}else{s.push(n)}if(t&&i+1==l.length){a.push("missing metdata block closing")}});var l={scripts:i.require,styles:i.style};delete i.script;delete i.style;if(l.scripts)l.scripts.forEach(function(e,t){var r=e.split(" ");var n={};for(var i=1;i<r.length;i+=2){var s=r.slice(i,i+2);n[s[0]]=s[1]}l.scripts[t]={script:r[0],as:n.as||null}});var o=["bookmarklet"].reduce(function(e,t){e[t]=i[t];delete i[t];return e},{});return Object.assign({metadata:i,code:s.join("\n"),errors:a.length?a:null,requires:l},o,e)}var s=e&&e.getAttribute("data-legume-entry")?Legume(e.getAttribute("data-legume-entry")):Promise.resolve();Array.from(document.querySelectorAll("script[type='text/legume']")).reduce(function(e,t){function r(){return Legume.process(t.textContent)}if(t.getAttribute("async")===null){r()}else e=e.then(r);return e},s)})(document.currentScript,window);
//# sourceMappingURL=legume.min.js.map