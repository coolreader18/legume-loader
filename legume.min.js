(()=>{var t=document.currentScript.dataset.legumeEntry;function e(t){let e=["github","npm"];for(let r=0;r<e.length;r++){let s=e[r];if(t.startsWith(`${s}:`)){return`https://cdn.jsdelivr.net/${s=="github"?"gh":s}/${t.replace(new RegExp(`${s}:`),"").trim()}`}}return t.trim()}function r(t,r){t=e(t);let s;try{s=new URL(t)}catch(e){if(e.message=="Failed to construct 'URL': Invalid URL"){s=new URL(t,location.href)}}return fetch(s).then(t=>{if(t.ok){return t}else{throw new Error(r)}}).catch(alert)}var s={version:"dev",scripts:{},dir:{scripts:{update(){s.json(scriptdirurl).then(t=>{delete this.unloaded;return Object.assign(this,t)})},get(t){var e=this[t];return e.url.replace(/%VERSION/,e.latest)},unloaded:true},styles:{update(){s.json(styledirurl).then(t=>{delete this.unloaded;return Object.assign(this,t)})},get(t){var e=this[t];return e.url.replace(/%VERSION/,e.latest)},unloaded:true}},load(t,e){if(typeof t=="string"){t=t.trim()}function r(t){let e=["json","text","script"];for(let r=0;r<e.length;r++){let n=e[r];if(t.startsWith(`${n}:`)){return s[n](t.replace(new RegExp(`${n}:`),"").trim())}}return s.script(t)}if(typeof e=="string"){switch(e){case"github":return s.github(t);case"script":return s.script(t);case"json":return s.json(t);case"text":return s.text(t);case"txtscript":return s.process(t);case"npm":return s.npm(t)}}if(typeof t=="string"){return r(t)}else if(Array.isArray(t)){let e=[];t.forEach(t=>e.push(r(t)));return Promise.all(e)}},async process(...t){var e=n(...t),r=e.metadata,a=e.code,i=(async()=>{if(!r.script){return}else{let e=r.script;for(var t=0;t<e.length;t++){await s.script(e[t])}return}})();if(r.style){r.style.forEach(s.style)}["var","async"].forEach(t=>{e[t]=e.metadata[t];delete e.metadata[t]});e.var=e.var||[];e.var=e.var.reduce((t,e)=>{var r=e.split(" ");t[r[0]]=r[1]||r[0];return t},{});var l={exports:{}},c=l.exports,u={module:l,exports:c};await i;if(e.legumescript&&e.metadata.name){let t=s.scripts[r.name]=s.scripts[r.name]||e;t.clicks=t.clicks+1||0;await new(e.async?Object.getPrototypeOf(async()=>{}).constructor:Function)(...Object.values(e.var),a).apply(t,Object.keys(e.var).map(t=>u[t]))}else{eval.call(null,a)}return!Object.getOwnPropertyNames(l.exports).length&&!Object.getOwnPropertySymbols(l.exports).length?undefined:l.exports},script(t){const e=t=>r(t,"Couldn't load the script.").then(t=>t.text()).then(s.process);if(t.startsWith("dir:")){t=t.replace(/dir:/,"").trim();return(async()=>s.dir.scripts.unloaded?await s.dir.scripts.update():s.dir.scripts)().then(r=>e(r.get(t)))}else{return e(t)}},style(t){t=e(t);const r=t=>{l.href=t;document.head.append(l)};l=document.createElement("link");l.rel="stylesheet";if(t.startsWith("dir:")){t=t.replace(/dir:/,"").trim();return(async()=>s.dir.styles.unloaded?await s.dir.styles.update():s.dir.styles)().then(e=>r(e.get(t)))}else{return r(t)}},github(t){return s.script(`https://cdn.jsdelivr.net/gh/${t}`)},json(t){return r(t,"Couldn't load JSON.").then(t=>t.json())},text(t){return r(t,"Couldn't load text.").then(t=>t.text())},npm(t){return r(`https://cdn.jsdelivr.net/npm/${t}`,"Couldn't load npm script.").then(t=>t.text()).then(s.process)}};window.Legume=s;if(t)s.load(t);function n(t,e){var r=false,s={cmt:/^(\s*\/\/\s*)/,multi:{start:/^(\s*\/\*\s*@legume\s*)/i,end:/^\s*\*\//},single:{start:/\s*@legume\s*/,match:/\s*@[^@]*/g}},n={name:"",version:"",description:"",repository:"",author:[],email:"",url:"",license:"",script:[],style:[],var:[],async:false},a={},i=[],l=[],c=false,u=t=>{var e=t.trim().match(/@([^\s]+)(?:\s+(.*))?$/);if(e){var r=e[1],s=e[2];if(r!==undefined){if(Array.isArray(n[r])){a[r]=a[r]||[];a[r].push(s)}else if(typeof n[r]=="boolean"){try{a[r]=JSON.parse(s)}catch(t){a[r]=true}}else{a[r]=s}}else{console.warn(`ignoring invalid metadata option: \`${r}\``)}}};t.match(/[^\r\n]+/g).forEach((t,e,n)=>{if(s.cmt.test(t)){var a=t.replace(s.cmt,"").trim();if(s.single.start.test(a)){a.replace(s.single.start,"");for(var o=s.single.match.exec(a);o;o=s.single.match.exec(a)){u(o[0])}}}else if(s.multi.end.test(t)&&r){r=false}else if(r){u(t)}else if(s.multi.start.test(t)){r=true;c=true}else{i.push(t)}if(r&&e+1==n.length){l.push("missing metdata block closing")}});return{metadata:Object.assign(a,e),code:i.join("\n"),errors:l.length?l:null,legumescript:c}}})();