legumeload=function(){delete legumeload;var entry=document.querySelector("script[src*=legume]");var AsyncFunction;try{AsyncFunction=Object.getPrototypeOf(eval("async () => {}")).constructor}catch(e){}function processurl(e){e=new URL(e);var t=["github","npm"];for(var r=0;r<t.length;r++){var n=t[r];if(e.protocol==n+":"){return"https://cdn.jsdelivr.net/"+(n=="github"?"gh":n)+e.pathname}}return e.href}function load(e,t){e=processurl(e);console.log(e);var r;try{r=new URL(e)}catch(t){if(t.message=="Failed to construct 'URL': Invalid URL"){r=new URL(e,location.href)}}return fetch(r).then(function(e){if(e.ok){return e}else{throw new Error(t)}}).catch(alert)}var legume={version:"dev",scripts:{},dir:{scripts:{update:function e(){var t=this;legume.json(scriptdirurl).then(function(e){delete t.unloaded;return Object.assign(t,e)})},get:function e(t){var r=this[t];return r.url.replace(/%VERSION/,r.latest)},unloaded:true},styles:{update:function e(){var t=this;legume.json(styledirurl).then(function(e){delete t.unloaded;return Object.assign(t,e)})},get:function e(t){var r=this[t];return r.url.replace(/%VERSION/,r.latest)},unloaded:true}},load:function e(t,r){if(typeof t=="string"){t=t.trim()}function n(e){var t=["json","text","script"];for(var r=0;r<t.length;r++){var n=t[r];if(e.startsWith(n+":")){return legume[n](e.replace(new RegExp(n+":"),"").trim())}}return legume.script(e)}if(typeof r=="string"){switch(r){case"script":return legume.script(t);case"json":return legume.json(t);case"text":return legume.text(t);case"txtscript":return legume.process(t)}}if(typeof t=="string"){return n(t)}else if(Array.isArray(t)){var s=[];t.forEach(function(e){s.push(n(e))});return Promise.all(s)}},process:function e(){var t=Array.from(arguments);return Promise.resolve().then(function(){var e=parse.apply(null,t),r=e.metadata,n=e.code,s=new Promise(function(e){if(!r.script){e()}else{var t=r.script;n(0);function n(r){return legume.script(t[r]).then(function(){if(t.length!=r+1){n(r+1)}else{e()}})}}});if(r.style){r.style.forEach(legume.style)}["var","async"].forEach(function(t){e[t]=e.metadata[t];delete e.metadata[t]});e.var=e.var||[];e.var=e.var.reduce(function(e,t){var r=t.split(" ");e[r[0]]=r[1]||r[0];return e},{});var i={exports:{}},l=i.exports,u={module:i,exports:l};return s.then(function(){var t;if(e.legumescript&&e.metadata.name){var s=legume.scripts[r.name]=legume.scripts[r.name]||e;s.clicks=s.clicks+1||0;t=Promise.resolve().then(function(){new(function(){if(e.async){if(AsyncFunction){return AsyncFunction}else{throw new Error("Async Functions not supported in this browser")}}else{return Function}}().apply)(null,Object.values(e.var).concat([n])).apply(s,Object.keys(e.var).map(function(e){return u[e]}))})}else{eval.call(null,n);t=Promise.resolve()}return t.then(function(){return!Object.getOwnPropertyNames(i.exports).length&&!Object.getOwnPropertySymbols(i.exports).length?undefined:i.exports})})})},script:function e(t){const r=function(e){return load(e,"Couldn't load the script.").then(function(e){console.log(e);return e.text()}).then(legume.process)};if(t.startsWith("dir:")){t=t.replace(/dir:/,"").trim();return Promise.resolve().then(function(){return legume.dir.scripts.unloaded?legume.dir.scripts.update():legume.dir.scripts}).then(function(e){return r(e.get(t))})}else{return r(t)}},style:function e(t){t=processurl(t);const r=function(e){l.href=e;document.head.append(l)};l=document.createElement("link");l.rel="stylesheet";if(t.startsWith("dir:")){t=t.replace(/dir:/,"").trim();return Promise.resolve().then(function(){return legume.dir.styles.unloaded?legume.dir.styles.update():legume.dir.styles}).then(function(e){return r(e.get(t))})}else{return r(t)}},json:function e(t){return load(t,"Couldn't load JSON.").then(function(e){return e.json()})},text:function e(t){return load(t,"Couldn't load text.").then(function(e){return e.text()})}};window.Legume=legume;if(entry)legume.load(entry);function parse(e,t){var r=false,n={cmt:/^(\s*\/\/\s*)/,multi:{start:/^(\s*\/\*\s*@legume\s*)/i,end:/^\s*\*\//},single:{start:/\s*@legume\s*/,match:/\s*@[^@]*/g}},s={name:"",version:"",description:"",repository:"",author:[],email:"",url:"",license:"",script:[],style:[],var:[],async:false},i={},l=[],u=[],o=false,a=function(e){var t=e.trim().match(/@([^\s]+)(?:\s+(.*))?$/);if(t){var r=t[1],n=t[2];if(r!==undefined){if(Array.isArray(s[r])){i[r]=i[r]||[];i[r].push(n)}else if(typeof s[r]=="boolean"){try{i[r]=JSON.parse(n)}catch(e){i[r]=true}}else{i[r]=n}}else{console.warn("ignoring invalid metadata option: `"+r+"}`")}}};e.match(/[^\r\n]+/g).forEach(function(e,t,s){if(n.cmt.test(e)){var i=e.replace(n.cmt,"").trim();if(n.single.start.test(i)){i.replace(n.single.start,"");for(var c=n.single.match.exec(i);c;c=n.single.match.exec(i)){a(c[0])}}}else if(n.multi.end.test(e)&&r){r=false}else if(r){a(e)}else if(n.multi.start.test(e)){r=true;o=true}else{l.push(e)}if(r&&t+1==s.length){u.push("missing metdata block closing")}});return{metadata:Object.assign(i,t),code:l.join("\n"),errors:u.length?u:null,legumescript:o}}Legume.load("npm:jquery")};(function(){var e="https://polyfill.io/v2/polyfill.min.js?features=default-3.6,fetch,Element.prototype.dataset&callback=legumeload";var t=document.createElement("script");t.src=e;document.getElementsByTagName("head")[0].appendChild(t)})();