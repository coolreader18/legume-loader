var Legume=function(e){"use strict";function t(e,t){try{e=new URL(e)}catch(r){if("Failed to construct 'URL': Invalid URL"!=r.message)throw r;e=new URL(e,t||location)}var r={url:e,originalUrl:e},n=e.pathname.split("/"),s=n[0].split("@"),i={github:function(){var t=n[1].split("@");return{url:new URL("https://cdn.jsdelivr.net/gh/"+e.pathname),name:t[0],version:t[1]||"latest"}},npm:function(){return{url:new URL("https://cdn.jsdelivr.net/npm/"+e.pathname),name:s[0],version:s[1]||"latest",legumescript:!0}},gist:function(){return{name:n[1].split(".")[0],gist:{id:s[0],file:n[1],hash:s[1]}}}},a=e.protocol.split(":")[0];return r.method=a,a in i?Object.assign(r,i[a]()):Object.assign(r,{name:e.pathname.split("/").slice(-1)[0].split(".")[0]}),r}function r(e,s){s=s||{};var i={};Object.assign(i,t(e,s.urlref));var a=Object.values(r.scripts).find(function(e){return e.url&&(e.url.href==i.url.href||e.originalUrl.href==i.originalUrl.href)});if(a)return Promise.resolve(n(a.name));var o=i.gist;return Promise.resolve("gist"==i.method&&fetch("https://api.github.com/gists/"+o.id+(o.hash?"/"+o.hash:"")).then(function(e){return e.json()}).then(function(e){var t=e.files[o.file];if(!t)throw new Error("File not in gist");if(i.url=new URL(t.raw_url),t.truncated)return fetch(i.url).then(function(e){return e.text()}).then(function(e){i.code=e});i.code=t.content})).then(function(){return r.scripts[i.name]?n(i.name):"code"in i?r.process(i,s.dontload):fetch(i.url).then(function(e){return e.text()}).then(function(e){return i.code=e,r.process(i,s.dontload)})})}function n(e){if(!(e=r.scripts[e]||Object.values(r.scripts).find(function(t){return t.metadata&&t.metadata.name==e})))throw new Error("Module not loaded");if(r.cache[e.name]&&!e.bookmarklet)return r.cache[e.name];e.loads++;var s={exports:{},children:e.children,legumeInfo:{loads:e.loads}};s.require=function e(t){return this.children[t]=r.scripts[t],e(t)}.bind(s);var i={module:s,require:s.require,exports:s.exports},a=["module","exports"],o=e.requires;o.scripts&&o.scripts.forEach(function(r){r.as&&!Object.keys(i).includes(r.as)&&(i[r.as]=n(t(r.script,e.url).name),a.push(r.as))});var l=e.code+(e.url||e.name?"\n//# sourceURL="+(e.url||"inline-legume:"+e.name):"");return e.legumescript?(eval.call(window,"with(Legume.global)("+Function.apply(null,a.concat([l])).toString()+")").apply(r.global,a.reduce(function(e,t){return e.push(i[t]),e},[])),r.cache[e.name]=s.exports,i.module.exports):eval.call(window,l)}var s=entry&&entry.getAttribute("data-legume-entry")?r(entry.getAttribute("data-legume-entry")):Promise.resolve();return Array.from(document.querySelectorAll("script[type='text/legume']")).reduce(function(e,t){function n(){return r.process(t.textContent)}return null===t.getAttribute("async")?n():e=e.then(n),e},s),(e=r).require=n,e.cache={},e.scripts={},e.process=function(e,t){if("string"==typeof e&&(e={code:e}),(e=function(e){var t=!1,r={start:/^(\s*\/\*\s*@legume\s*)/i,end:/^\s*\*\//},n={name:"",version:"",description:"",repository:"",author:[],email:"",url:"",license:"",bookmarklet:!1,require:[],style:[]},s={},i=[],a=[];e.code.match(/[^\r\n]+/g).forEach(function(o,l,c){r.end.test(o)&&t?t=!1:t?function(e){var t=e.trim().match(/@([^\s]+)(?:\s+(.*))?$/);if(t){var r=t[1],i=t[2];if(void 0!==r)if(Array.isArray(n[r]))s[r]=s[r]||[],s[r].push(i);else if("boolean"==typeof n[r])try{s[r]=JSON.parse(i)}catch(e){s[r]=!0}else s[r]=i;else console.warn("ignoring invalid metadata option: `"+r+"}`")}}(o):r.start.test(o)?(t=!0,e.legumescript=!0):i.push(o),t&&l+1==c.length&&a.push("missing metdata block closing")});var o={scripts:s.require,styles:s.style};delete s.script,delete s.style,o.scripts&&o.scripts.forEach(function(e,t){for(var r=e.split(" "),n={},s=1;s<r.length;s+=2){var i=r.slice(s,s+2);n[i[0]]=i[1]}o.scripts[t]={script:r[0],as:n.as||null}});var l=["bookmarklet"].reduce(function(e,t){return e[t]=s[t],delete s[t],e},{});return Object.assign({metadata:s,code:i.join("\n"),errors:a.length?a:null,requires:o},l,e)}(e)).name=e.name||e.metadata.name,e.loads=0,r.scripts[e.name])return t?void 0:n(e.name);r.scripts[e.name]=e;var s=Promise.resolve(),i=e.requires;return i.styles&&i.styles.forEach(function(e){r.style(e)}),i.scripts&&(s=s.then(function(){return Promise.all(i.scripts.reduce(function(t,n){return t.push(r(n.script,{dontload:!0,urlref:e.url})),t},[]))})),s.then(function(){t||n(e.name)})},e.style=function(e,r){e=t(e,r).url,document.head.appendChild(Object.assign(document.createElement("link"),{rel:"stylesheet",href:e}))},e}({});
